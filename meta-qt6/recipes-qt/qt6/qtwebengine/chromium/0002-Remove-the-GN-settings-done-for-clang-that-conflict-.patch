From 52daa0655f83c4da7f707fbfc19653f1c1490fdf Mon Sep 17 00:00:00 2001
From: Khem Raj <raj.khem@gmail.com>
Date: Mon, 29 Apr 2019 12:00:19 +0300
Subject: [PATCH] Remove the GN settings done for clang that conflict with OE

clang cross compiler that is build with meta-clang has lot of these
settings built-in and specifying them here confuses the compiler

--target option and -no-canonical-prefixes options result in clang

finding the headers in target sysroot

Upstream-Status: Inappropriate [OE-Specific]

Signed-off-by: Khem Raj <raj.khem@gmail.com>
Rebased-by: Maksim Sisov <msisov@igalia.com>
Rebased-by: Randy MacLeod <randy.macleod@windriver.com>
---
 chromium/build/config/compiler/BUILD.gn | 39 -------------------------
 1 file changed, 39 deletions(-)

diff --git a/chromium/build/config/compiler/BUILD.gn b/chromium/build/config/compiler/BUILD.gn
index e5fc772da22..8c0774ed7c2 100644
--- a/chromium/build/config/compiler/BUILD.gn
+++ b/chromium/build/config/compiler/BUILD.gn
@@ -1376,8 +1376,6 @@ config("compiler_cpu_abi") {
     # simplicity we always explicitly set the architecture.
     if (current_cpu == "x64") {
       if (is_clang && !is_android && !is_fuchsia && !is_chromeos_device) {
-        cflags += [ "--target=x86_64-unknown-linux-gnu" ]
-        ldflags += [ "--target=x86_64-unknown-linux-gnu" ]
       } else {
         cflags += [ "-m64" ]
         ldflags += [ "-m64" ]
@@ -1385,8 +1383,6 @@ config("compiler_cpu_abi") {
       cflags += [ "-msse3" ]
     } else if (current_cpu == "x86") {
       if (is_clang && !is_android && !is_chromeos_device) {
-        cflags += [ "--target=i386-unknown-linux-gnu" ]
-        ldflags += [ "--target=i386-unknown-linux-gnu" ]
       } else {
         cflags += [ "-m32" ]
         ldflags += [ "-m32" ]
@@ -1396,10 +1392,6 @@ config("compiler_cpu_abi") {
         "-msse3",
       ]
     } else if (current_cpu == "arm") {
-      if (is_clang && !is_android && !is_chromeos_device) {
-        cflags += [ "--target=arm-linux-gnueabihf" ]
-        ldflags += [ "--target=arm-linux-gnueabihf" ]
-      }
       cflags += ["-mfloat-abi=$arm_float_abi"]
       if (arm_arch != "") {
         cflags += [ "-march=$arm_arch"]
@@ -1410,11 +1402,6 @@ config("compiler_cpu_abi") {
       if (arm_tune != "") {
         cflags += [ "-mtune=$arm_tune" ]
       }
-    } else if (current_cpu == "arm64") {
-      if (is_clang && !is_android && !is_fuchsia && !is_chromeos_device) {
-        cflags += [ "--target=aarch64-linux-gnu" ]
-        ldflags += [ "--target=aarch64-linux-gnu" ]
-      }
     } else if (current_cpu == "mipsel") {
       ldflags += [ "-Wl,--hash-style=sysv" ]
       if (custom_toolchain == "") {
@@ -1422,9 +1409,6 @@ config("compiler_cpu_abi") {
           if (is_android) {
             cflags += [ "--target=mipsel-linux-android" ]
             ldflags += [ "--target=mipsel-linux-android" ]
-          } else {
-            cflags += [ "--target=mipsel-linux-gnu" ]
-            ldflags += [ "--target=mipsel-linux-gnu" ]
           }
         } else {
           cflags += [ "-EL" ]
@@ -1504,8 +1488,6 @@ config("compiler_cpu_abi") {
       ldflags += [ "-Wl,--hash-style=sysv" ]
       if (custom_toolchain == "") {
         if (is_clang) {
-          cflags += [ "--target=mips-linux-gnu" ]
-          ldflags += [ "--target=mips-linux-gnu" ]
         } else {
           cflags += [ "-EB" ]
           ldflags += [ "-EB" ]
@@ -1553,9 +1535,6 @@ config("compiler_cpu_abi") {
           if (is_android) {
             cflags += [ "--target=mips64el-linux-android" ]
             ldflags += [ "--target=mips64el-linux-android" ]
-          } else {
-            cflags += [ "--target=mips64el-linux-gnuabi64" ]
-            ldflags += [ "--target=mips64el-linux-gnuabi64" ]
           }
         } else {
           cflags += [
@@ -1613,8 +1592,6 @@ config("compiler_cpu_abi") {
       ldflags += [ "-Wl,--hash-style=sysv" ]
       if (custom_toolchain == "") {
         if (is_clang) {
-          cflags += [ "--target=mips64-linux-gnuabi64" ]
-          ldflags += [ "--target=mips64-linux-gnuabi64" ]
         } else {
           cflags += [
             "-EB",
@@ -1650,39 +1627,23 @@ config("compiler_cpu_abi") {
     } else if (current_cpu == "ppc64") {
       if (current_os == "aix") {
         if (is_clang) {
-          cflags += [ "--target=powerpc64-ibm-aix" ]
-          ldflags += [ "--target=powerpc64-ibm-aix" ]
         } else {
           cflags += [ "-maix64" ]
           ldflags += [ "-maix64" ]
         }
       } else if (is_clang) {
-        cflags += [ "--target=powerpc64le-unknown-linux-gnu" ]
-        ldflags += [ "--target=powerpc64le-unknown-linux-gnu" ]
       } else {
         cflags += [ "-m64" ]
         ldflags += [ "-m64" ]
       }
     } else if (current_cpu == "riscv64") {
-      if (is_clang && !is_android) {
-        cflags += [ "--target=riscv64-linux-gnu" ]
-        ldflags += [ "--target=riscv64-linux-gnu" ]
-      }
       cflags += [ "-mabi=lp64d" ]
     } else if (current_cpu == "loong64") {
-      if (is_clang) {
-        cflags += [ "--target=loongarch64-linux-gnu" ]
-        ldflags += [ "--target=loongarch64-linux-gnu" ]
-      }
       cflags += [
         "-mabi=lp64d",
         "-mcmodel=medium",
       ]
     } else if (current_cpu == "s390x") {
-      if (is_clang) {
-        cflags += [ "--target=s390x-unknown-linux-gnu" ]
-        ldflags += [ "--target=s390x-unknown-linux-gnu" ]
-      }
       cflags += [ "-m64" ]
       ldflags += [ "-m64" ]
     }
